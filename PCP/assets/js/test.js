const v300 = "https://script.google.com/macros/s/AKfycbzPSXRntXbqVZ-tfmJazl44EkTU8sCsv7xT0wQJKDI_DtQHYqNw2wvBKML_HJjRstcC/exec?";

var GPP = [
    {
        "tag": "",
        "uuid": "P1",
        "timestamp": "2023-07-03T10:51:34.878Z",
        "email": "tanmay.gurav@welingkar.org",
        "name": 64,
        "std_ID": 1003,
        "program": "RBA",
        "domain": "Banking",
        "title": "Test Title",
        "description": "Test DescriptionWhat is the problem ? 1Where is the user experiencing the problem ? 1When does the problem present itself to the user ? 1What other activities are the users performing while they experience the problem ? 1Why should this problem be solved ? / What is the benefit to the user of solving this problem ? 1",
        "solution": "Possible Solution 1",
        "media": ""
    },
    {
        "tag": "accepted",
        "uuid": "P2",
        "timestamp": "2023-07-03T10:54:14.551Z",
        "email": "tanmay.gurav@welingkar.org",
        "name": "awd1wwd1123e",
        "std_ID": "",
        "program": "RBA",
        "domain": "Finance",
        "title": "awqd",
        "description": "awdWhat is the problem ? 2Where is the user experiencing the problem ? 2When does the problem present itself to the user ? 2What other activities are the users performing while they experience the problem ? 2Why should this problem be solved ? / What is the benefit to the user of solving this problem ? 2",
        "solution": "Possible Solution 2",
        "media": ""
    },
    {
        "tag": "rejected",
        "uuid": "P3",
        "timestamp": "2023-07-03T10:56:26.947Z",
        "email": "tanmay.gurav@welingkar.org",
        "name": "qwerty",
        "std_ID": "",
        "program": "RBA",
        "domain": "Banking",
        "title": "Test Title 2",
        "description": "12eWhat is the problem ? 3Where is the user experiencing the problem ? 3When does the problem present itself to the user ? 3What other activities are the users performing while they experience the problem ? 3Why should this problem be solved ? / What is the benefit to the user of solving this problem ? 3",
        "solution": "Possible Solution 3",
        "media": ""
    },
    {
        "tag": "accepted",
        "uuid": "P4",
        "timestamp": "2023-07-03T10:56:45.797Z",
        "email": "tanmay.gurav@welingkar.org",
        "name": "e5rty",
        "std_ID": 423,
        "program": "BD",
        "domain": "Finance",
        "title": "dfgbs",
        "description": "srgWhat is the problem ? 4Where is the user experiencing the problem ? 4When does the problem present itself to the user ? 4What other activities are the users performing while they experience the problem ? 4Why should this problem be solved ? / What is the benefit to the user of solving this problem ? 4",
        "solution": "Possible Solution 4",
        "media": ""
    },
    {
        "tag": "rejected",
        "uuid": "P5",
        "timestamp": "2023-07-04T05:40:30.488Z",
        "email": "tanmay.gurav@welingkar.org",
        "name": "arf",
        "std_ID": "aef",
        "program": "RBA",
        "domain": "Finance",
        "title": "awef",
        "description": "awf43wafWhat is the problem ? 5Where is the user experiencing the problem ? 5When does the problem present itself to the user ? 5What other activities are the users performing while they experience the problem ? 5Why should this problem be solved ? / What is the benefit to the user of solving this problem ? 5",
        "solution": "Possible Solution 5",
        "media": ""
    },
    {
        "tag": "accepted",
        "uuid": "P6",
        "timestamp": "2023-09-05T09:03:47.798Z",
        "email": "tanmayvgurav@gmail.com",
        "name": "Tanmay Gurav",
        "std_ID": 1234,
        "program": "BD",
        "domain": "Banking",
        "title": "testing title",
        "description": "testing tile Who is experiencing the problem?\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Neque sodales ut etiam sit amet. Morbi tristique senectus et netus. Laoreet sit amet cursus sit amet dictum. Feugiat vivamus at augue eget arcu dictum. Bibendum ut tristique et egestas quis. Id interdum velit laoreet id donec ultrices. Sem fringilla ut morbi tincidunt augue interdum velit euismod in.testing tile What is the problem?\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Neque sodales ut etiam sit amet. Morbi tristique senectus et netus. Laoreet sit amet cursus sit amet dictum. Feugiat vivamus at augue eget arcu dictum. Bibendum ut tristique et egestas quis. Id interdum velit laoreet id donec ultrices. Sem fringilla ut morbi tincidunt augue interdum velit euismod in.testing tile Where is the user experiencing the problem?\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Neque sodales ut etiam sit amet. Morbi tristique senectus et netus. Laoreet sit amet cursus sit amet dictum. Feugiat vivamus at augue eget arcu dictum. Bibendum ut tristique et egestas quis. Id interdum velit laoreet id donec ultrices. Sem fringilla ut morbi tincidunt augue interdum velit euismod in.testing tile When does the problem present itself to the user?\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Neque sodales ut etiam sit amet. Morbi tristique senectus et netus. Laoreet sit amet cursus sit amet dictum. Feugiat vivamus at augue eget arcu dictum. Bibendum ut tristique et egestas quis. Id interdum velit laoreet id donec ultrices. Sem fringilla ut morbi tincidunt augue interdum velit euismod in.\ntesting tile What other activities are the users performing while they experience the problem?\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Neque sodales ut etiam sit amet. Morbi tristique senectus et netus. Laoreet sit amet cursus sit amet dictum. Feugiat vivamus at augue eget arcu dictum. Bibendum ut tristique et egestas quis. Id interdum velit laoreet id donec ultrices. Sem fringilla ut morbi tincidunt augue interdum velit euismod in.testing tile Why should this problem be solved? / What is the benefit to the user of solving this problem?\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Neque sodales ut etiam sit amet. Morbi tristique senectus et netus. Laoreet sit amet cursus sit amet dictum. Feugiat vivamus at augue eget arcu dictum. Bibendum ut tristique et egestas quis. Id interdum velit laoreet id donec ultrices. Sem fringilla ut morbi tincidunt augue interdum velit euismod in.",
        "solution": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Pharetra vel turpis nunc eget lorem dolor sed viverra ipsum. Platea dictumst quisque sagittis purus sit amet volutpat consequat. Neque sodales ut etiam sit amet. Morbi tristique senectus et netus. Laoreet sit amet cursus sit amet dictum. Feugiat vivamus at augue eget arcu dictum. Bibendum ut tristique et egestas quis. Id interdum velit laoreet id donec ultrices. Sem fringilla ut morbi tincidunt augue interdum velit euismod in.",
        "media": ""
    }
]

var filteredPP = []

function formatTimestamp(timestamp) {
    const date = new Date(timestamp);

    // Months array to convert numeric month to string
    const months = [
        "Jan",
        "Feb",
        "Mar",
        "Apr",
        "May",
        "Jun",
        "Jul",
        "Aug",
        "Sep",
        "Oct",
        "Nov",
        "Dec",
    ];

    // Get day, month, year
    const day = date.getDate();
    const month = months[date.getMonth()];
    const year = date.getFullYear();

    // Get hours and minutes
    let hours = date.getHours();
    const minutes = ("0" + date.getMinutes()).slice(-2);

    // AM or PM
    const ampm = hours >= 12 ? "PM" : "AM";

    // Convert hours to 12-hour format
    hours = hours % 12;
    hours = hours ? hours : 12;

    // Format the string
    const formattedDate = `${day}/${month}/${year} ${hours}:${minutes} ${ampm}`;

    return formattedDate;
}

function encodeQuery(data) {
    let query = data.url
    for (let d in data.params)
        query += encodeURIComponent(d) + '='
            + encodeURIComponent(data.params[d]) + '&';
    return query.slice(0, -1)
}

function toggletags(uuid) {
    var options = document.getElementById(uuid + "+tags")
    if (options.style.display == "none") options.style.display = "block"
    else options.style.display = "none"

}

async function tag(id, status) {
    toggletags(id)
    const spinId = `spin-${id}`;
    const spin = document.getElementById(spinId)
    const checkbox = document.getElementById(id + "+btn")

    if (spin.style.display === 'none') {
        spin.style.display = 'block';
        checkbox.style.display = 'none';
    }

    data = {
        url: v300,
        params: {
            code: "markstatus",
            uuid: id,
            status: status,
        },
    };
    const query = encodeQuery(data);
    const response = await fetch(query);
    const res = await response.json();
    if (spin.style.display === 'block') {
        spin.style.display = 'none';
        checkbox.style.display = 'block';
    }
    if (response.status != 200) alert("Request returned status code", res.status);
    if (response.status === 200) {
        if (res.status === "SUCCESS") {
            updaterow(id, status)
            updateGPP(id, status)
        }
    }


}

function updaterow(id, status) {
    if (status == "accepted") {
        document.getElementById(id + "+row_tick").className = ""
        document.getElementById(id + "+row_tick").classList.toggle("row-tick-green")
        document.getElementById(id + "+row_title").className = ""
        document.getElementById(id + "+row_title").classList.toggle("row-title-bg-green")
        document.getElementById(id + "+row_desc").className = ""
        document.getElementById(id + "+row_desc").classList.toggle("row-desc-bg-green")
        document.getElementById(id + "+row_sol").className = ""
        document.getElementById(id + "+row_sol").classList.toggle("row-sol-bg-green")
        document.getElementById(id + "+row_img").className = ""
        document.getElementById(id + "+row_img").classList.toggle("row-img-bg-green")
        document.getElementById(id + "+checkbox").src = "./assets/img/accepted.svg"
    } else {
        document.getElementById(id + "+row_tick").className = ""
        document.getElementById(id + "+row_tick").classList.toggle("row-tick-red")
        document.getElementById(id + "+row_title").className = ""
        document.getElementById(id + "+row_title").classList.toggle("row-title-bg-red")
        document.getElementById(id + "+row_desc").className = ""
        document.getElementById(id + "+row_desc").classList.toggle("row-desc-bg-red")
        document.getElementById(id + "+row_sol").className = ""
        document.getElementById(id + "+row_sol").classList.toggle("row-sol-bg-red")
        document.getElementById(id + "+row_img").className = ""
        document.getElementById(id + "+row_img").classList.toggle("row-img-bg-red")
        document.getElementById(id + "+checkbox").src = "./assets/img/rejected.svg"
    }

}

function updateGPP(id, status) {
    for (let i = 0; i < GPP.length; i++) {
        const item = GPP[i];
        if (item.uuid == id) {
            item.tag = status
            return
        }
    }
}

function renderfacultypp() {
    const PSlist = document.getElementById("PSList");
    const filterbar = document.getElementById("filterbar")
    const PSHeader = document.getElementById("PSHeader")
    filterbar.removeAttribute("hidden")
    filterbar.classList.add("d-flex")
    PSHeader.removeAttribute("hidden")
    PSlist.innerHTML = ""
    if (filteredPP.length <= 0) {
        filteredPP = GPP
    }
    filteredPP.forEach((i) => {
        const checkboxId = `check-${i.uuid}`;
        const spinId = `spin-${i.uuid}`;
        const formattedDate = formatTimestamp(`${i.timestamp}`);

        if (!i.tag) {
            PSlist.innerHTML += `
                <div id="${i.uuid}" class="flex-container">
                    <div id="${i.uuid}+row_tick" class="row-tick">
                        <button data-bs-toggle="popover" class="row-button" onclick="toggletags('${i.uuid}')" id="${i.uuid}+btn" type="button" value=" " style="display: block;">
                            <img id="${i.uuid}+checkbox" src="./assets/img/uncheck.svg" alt="unmarked" width="100%" height="100%">
                        </button>
                        <div class="loader" id="${spinId}" style="display: none;"></div>
                        <div id="${i.uuid}+tags" class="custom_pill" style="display: none;">
                            <img class="selectionboxleft " src="./assets/img/accepted.svg" alt="check" onclick="tag('${i.uuid}','accepted')">
                            <img class="selectionboxright " src="./assets/img/rejected.svg" alt="cross" onclick="tag('${i.uuid}','rejected')">
                        </div>
                    </div>
                    <div id="${i.uuid}+row_title" class="row-title-bg">
                        <div class="row-title-ps-title">
                            ${i.title}
                        </div>
                        <div class="row-title-ps-domain">
                            ${i.domain}
                        </div>
                        <div class="row-title-ps-number">
                            ${i.uuid}
                            <div class="row-title-ps-time">${formattedDate}</div>
                        </div>
                    </div>
                    <div id="${i.uuid}+row_desc" class="row-desc-bg">
                        <div class="row-desc-ps-desc">
                            ${i.description}
                        </div>
                    </div>
                    <div id="${i.uuid}+row_sol" class="row-sol-bg">
                        <div class="row-sol-ps-sol">
                            ${i.solution}
                        </div>
                    </div>
                    <div id="${i.uuid}+row_img" class="row-img-bg" onclick="renderviewMore('${i.uuid}')">
                        <div class="row-img-flex">
                            <div class="row-img-view-picture-icon"></div>
                            <div class="row-img-info-icon"></div>
                            <div class="row-img-add-comment-icon"></div>
                        </div>
                        <div class="row-img-font">
                            View More
                        </div>
                    </div>
                </div>
                <div style="height: 5px"></div>
                `;
        } else if (i.tag === "accepted") {
            PSlist.innerHTML += `
                <div id="${i.uuid}" class="flex-container">
                    <div id="${i.uuid}+row_tick" class="row-tick-green">
                        <button data-bs-toggle="popover" data-bs-trigger="focus" class="row-button" onclick="toggletags('${i.uuid}')" id="${i.uuid}+btn" type="button" value="accepted" style="display: block;">
                            <img id="${i.uuid}+checkbox" src="./assets/img/accepted.svg" alt="unmarked" width="100%" height="100%">
                        </button>
                        <div class="loader" id="${spinId}" style="display: none;"></div>
                        <div id="${i.uuid}+tags" class="custom_pill" style="display: none;">
                            <img class="selectionboxleft " src="./assets/img/accepted.svg" alt="check" onclick="tag('${i.uuid}','accepted')">
                            <img class="selectionboxright " src="./assets/img/rejected.svg" alt="cross" onclick="tag('${i.uuid}','rejected')">
                        </div>
                    </div>
                    <div id="${i.uuid}+row_title" class="row-title-bg-green">
                        <div class="row-title-ps-title">
                            ${i.title}
                        </div>
                        <div class="row-title-ps-domain">
                            ${i.domain}
                        </div>
                        <div class="row-title-ps-number">
                            ${i.uuid}
                            <div class="row-title-ps-time">${formattedDate}</div>
                        </div>
                    </div>
                    <div id="${i.uuid}+row_desc" class="row-desc-bg-green">
                        <div class="row-desc-ps-desc">
                            ${i.description}
                        </div>
                    </div>
                    <div id="${i.uuid}+row_sol" class="row-sol-bg-green">
                        <div class="row-sol-ps-sol">
                            ${i.solution}
                        </div>
                    </div>
                    <div id="${i.uuid}+row_img" class="row-img-bg-green" onclick="renderviewMore('${i.uuid}')">
                        <div class="row-img-flex">
                            <div class="row-img-view-picture-icon"></div>
                            <div class="row-img-info-icon"></div>
                            <div class="row-img-add-comment-icon"></div>
                        </div>
                        <div class="row-img-font">
                            View More
                        </div>
                    </div>
                </div>
                <div style="height: 5px"></div>
                `;
        } else if (i.tag === "rejected") {
            PSlist.innerHTML += `
                <div id="${i.uuid}" class="flex-container">
                    <div id="${i.uuid}+row_tick" class="row-tick-red">
                        <button class="row-button" onclick="toggletags('${i.uuid}')" id="${i.uuid}+btn" type="button" value="rejected" style="display: block;" data-bs-trigger="focus" data-bs-toggle="popover">
                            <img id="${i.uuid}+checkbox" src="./assets/img/rejected.svg" alt="unmarked" width="100%" height="100%">
                        </button>
                        <div class="loader" id="${spinId}" style="display: none;"></div>
                        <div id="${i.uuid}+tags" class="custom_pill" style="display: none;">
                            <img class="selectionboxleft " src="./assets/img/accepted.svg" alt="check" onclick="tag('${i.uuid}','accepted')">
                            <img class="selectionboxright " src="./assets/img/rejected.svg" alt="cross" onclick="tag('${i.uuid}','rejected')">
                        </div>
                    </div>
                    <div id="${i.uuid}+row_title" class="row-title-bg-red">
                        <div class="row-title-ps-title">
                            ${i.title}
                        </div>
                        <div class="row-title-ps-domain">
                            ${i.domain}
                        </div>
                        <div class="row-title-ps-number">
                            ${i.uuid}
                            <div class="row-title-ps-time">${formattedDate}</div>
                        </div>
                    </div>
                    <div id="${i.uuid}+row_desc" class="row-desc-bg-red">
                        <div class="row-desc-ps-desc">
                            ${i.description}
                        </div>
                    </div>
                    <div id="${i.uuid}+row_sol" class="row-sol-bg-red">
                        <div class="row-sol-ps-sol">
                            ${i.solution}
                        </div>
                    </div>
                    <div id="${i.uuid}+row_img" class="row-img-bg-red" onclick="renderviewMore('${i.uuid}')">
                        <div class="row-img-flex">
                            <div class="row-img-view-picture-icon"></div>
                            <div class="row-img-info-icon"></div>
                            <div class="row-img-add-comment-icon"></div>
                        </div>
                        <div class="row-img-font">
                            View More
                        </div>
                    </div>
                </div>
                <div style="height: 5px"></div>
                `;
        }
    });
}


renderfacultypp()